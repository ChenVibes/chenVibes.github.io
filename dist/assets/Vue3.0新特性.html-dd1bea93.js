import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o,c,b as n,d as s,a as t,e as l}from"./app-d605ab7d.js";const i={},u=l(`<h2 id="vue3-0-æ–°ç‰¹æ€§" tabindex="-1"><a class="header-anchor" href="#vue3-0-æ–°ç‰¹æ€§" aria-hidden="true">#</a> Vue3.0 æ–°ç‰¹æ€§</h2><h3 id="vue-ä¸­æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#vue-ä¸­æ€§èƒ½ä¼˜åŒ–" aria-hidden="true">#</a> Vue ä¸­æ€§èƒ½ä¼˜åŒ–</h3><h4 id="è·¯ç”±æ‡’åŠ è½½" tabindex="-1"><a class="header-anchor" href="#è·¯ç”±æ‡’åŠ è½½" aria-hidden="true">#</a> è·¯ç”±æ‡’åŠ è½½</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">&#39;/foo&#39;</span><span class="token punctuation">,</span> <span class="token function-variable function">component</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./Foo.vue&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¼‚æ­¥ç»„ä»¶" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&#39;async-webpack-example&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™ä¸ªç‰¹æ®Šçš„ \`require\` è¯­æ³•å°†ä¼šå‘Šè¯‰ webpack</span>
  <span class="token comment">// è‡ªåŠ¨å°†ä½ çš„æ„å»ºä»£ç åˆ‡å‰²æˆå¤šä¸ªåŒ…ï¼Œè¿™äº›åŒ…</span>
  <span class="token comment">// ä¼šé€šè¿‡ Ajax è¯·æ±‚åŠ è½½</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;./my-async-component&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">components</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&#39;my-component&#39;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./my-async-component&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="keep-alive-ç¼“å­˜é¡µé¢" tabindex="-1"><a class="header-anchor" href="#keep-alive-ç¼“å­˜é¡µé¢" aria-hidden="true">#</a> keep-alive ç¼“å­˜é¡µé¢</h4><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-view</span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>keep-alive</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä½¿ç”¨-v-show-å¤ç”¨-dom" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-v-show-å¤ç”¨-dom" aria-hidden="true">#</a> ä½¿ç”¨ v-show å¤ç”¨ DOM</h4><h4 id="v-for-éå†é¿å…åŒæ—¶ä½¿ç”¨-v-if" tabindex="-1"><a class="header-anchor" href="#v-for-éå†é¿å…åŒæ—¶ä½¿ç”¨-v-if" aria-hidden="true">#</a> v-for éå†é¿å…åŒæ—¶ä½¿ç”¨ v-if</h4><h4 id="é•¿åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#é•¿åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–" aria-hidden="true">#</a> é•¿åˆ—è¡¨æ€§èƒ½ä¼˜åŒ–</h4><ul><li>å¦‚æœåˆ—è¡¨æ˜¯çº¯ç²¹çš„æ•°æ®å±•ç¤ºï¼Œä¸ä¼šæœ‰ä»»ä½•æ”¹å˜ï¼Œå°±ä¸éœ€è¦åšå“åº”åŒ–</li><li>åˆ©ç”¨ Object.freeze å†»ç»“å¯¹è±¡ï¼Œä¿æŠ¤ä¸è¢«ä¿®æ”¹</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">users</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">async</span> <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/users&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>users <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœæ˜¯å¤§æ•°æ®é•¿åˆ—è¡¨ï¼Œå¯é‡‡ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼Œåªæ¸²æŸ“å°‘éƒ¨åˆ†åŒºåŸŸçš„å†…å®¹ vue-virtual-scroller åº“</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>recycle-scroller</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:items</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>items<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:item-size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>24<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{ item }<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FetchItemView</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@vote</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>voteItem(item)<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>recycle-scroller</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="äº‹ä»¶çš„é”€æ¯" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶çš„é”€æ¯" aria-hidden="true">#</a> äº‹ä»¶çš„é”€æ¯</h4><p>æ³¨æ„åœ¨ beforeDestroy å‘¨æœŸä¸­é”€æ¯ç»‘å®šçš„äº‹ä»¶ï¼Œå®šæ—¶å™¨ç­‰</p><h4 id="å›¾ç‰‡æ‡’åŠ è½½-vue-lazyload-åº“" tabindex="-1"><a class="header-anchor" href="#å›¾ç‰‡æ‡’åŠ è½½-vue-lazyload-åº“" aria-hidden="true">#</a> å›¾ç‰‡æ‡’åŠ è½½ vue-lazyload åº“</h4><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">v-lazy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/img/1.png<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="refã€reactiveã€torefã€torefs-çš„åŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#refã€reactiveã€torefã€torefs-çš„åŒºåˆ«" aria-hidden="true">#</a> refã€reactiveã€toRefã€toRefs çš„åŒºåˆ«</h3><h4 id="reactive" tabindex="-1"><a class="header-anchor" href="#reactive" aria-hidden="true">#</a> reactive</h4><p>reactive ç”¨äºä¸ºå¯¹è±¡æ·»åŠ å“åº”å¼çŠ¶æ€ã€‚æ¥æ”¶ä¸€ä¸ª js å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå…·æœ‰å“åº”å¼çŠ¶æ€çš„å‰¯æœ¬ã€‚</p><ul><li>è·å–æ•°æ®å€¼çš„æ—¶å€™ç›´æ¥è·å–ï¼Œä¸éœ€è¦åŠ .value</li><li>å‚æ•°åªèƒ½ä¼ å…¥å¯¹è±¡ç±»å‹</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token comment">// å“åº”å¼çŠ¶æ€</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// æ‰“å° count çš„å€¼</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ref" tabindex="-1"><a class="header-anchor" href="#ref" aria-hidden="true">#</a> ref</h4><p>ref ç”¨äºä¸ºæ•°æ®æ·»åŠ å“åº”å¼çŠ¶æ€ã€‚ç”±äº reactive åªèƒ½ä¼ å…¥å¯¹è±¡ç±»å‹çš„å‚æ•°ï¼Œè€Œå¯¹äºåŸºæœ¬æ•°æ®ç±»å‹è¦æ·»åŠ å“åº”å¼çŠ¶æ€å°±åªèƒ½ç”¨ ref äº†ï¼ŒåŒæ ·è¿”å›ä¸€ä¸ªå…·æœ‰å“åº”å¼çŠ¶æ€çš„å‰¯æœ¬ã€‚</p><ul><li>è·å–æ•°æ®å€¼çš„æ—¶å€™éœ€è¦åŠ .valueã€‚å¯ä»¥ç†è§£ä¸º ref æ˜¯é€šè¿‡ reactive åŒ…è£…äº†ä¸€å±‚å…·æœ‰ value å±æ€§çš„å¯¹è±¡å®ç°çš„</li><li><strong>å‚æ•°å¯ä»¥ä¼ é€’ä»»æ„æ•°æ®ç±»å‹</strong>ï¼Œä¼ é€’å¯¹è±¡ç±»å‹æ—¶ä¹Ÿèƒ½ä¿æŒæ·±åº¦å“åº”å¼ï¼Œæ‰€ä»¥é€‚ç”¨æ€§æ›´å¹¿ã€‚</li><li>vue 3.0 setup é‡Œå®šä¹‰æ•°æ®æ—¶æ¨èä¼˜å…ˆä½¿ç”¨ refï¼Œæ–¹ä¾¿é€»è¾‘æ‹†åˆ†å’Œä¸šåŠ¡è§£è€¦ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token comment">// ä¸ºåŸºæœ¬æ•°æ®ç±»å‹æ·»åŠ å“åº”å¼çŠ¶æ€</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&#39;Neo&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// ä¸ºå¤æ‚æ•°æ®ç±»å‹æ·»åŠ å“åº”å¼çŠ¶æ€</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// æ‰“å° name çš„å€¼</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token comment">// æ‰“å° count çš„å€¼</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>value<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="toref" tabindex="-1"><a class="header-anchor" href="#toref" aria-hidden="true">#</a> toRef</h4><p>toRef ç”¨äºä¸ºæºå“åº”å¼å¯¹è±¡ä¸Šçš„å±æ€§æ–°å»ºä¸€ä¸ª refï¼Œä»è€Œä¿æŒå¯¹å…¶æºå¯¹è±¡å±æ€§çš„å“åº”å¼è¿æ¥ã€‚æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šæºå“åº”å¼å¯¹è±¡å’Œå±æ€§åï¼Œè¿”å›ä¸€ä¸ª ref æ•°æ®ã€‚ä¾‹å¦‚ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ é€’çš„ props æ•°æ®æ—¶ï¼Œè¦å¼•ç”¨ props çš„æŸä¸ªå±æ€§ä¸”è¦ä¿æŒå“åº”å¼è¿æ¥æ—¶å°±å¾ˆæœ‰ç”¨ã€‚</p><ul><li>è·å–æ•°æ®å€¼çš„æ—¶å€™éœ€è¦åŠ .value</li><li>toRef åçš„ ref æ•°æ®ä¸æ˜¯åŸå§‹æ•°æ®çš„æ‹·è´ï¼Œè€Œæ˜¯å¼•ç”¨ï¼Œæ”¹å˜ç»“æœæ•°æ®çš„å€¼ä¹Ÿä¼šåŒæ—¶æ”¹å˜åŸå§‹æ•°æ®</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> toRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åˆ›å»ºå˜é‡ myTitle</span>
    <span class="token keyword">const</span> myTitle <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">&#39;title&#39;</span><span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myTitle<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="torefs" tabindex="-1"><a class="header-anchor" href="#torefs" aria-hidden="true">#</a> toRefs</h4><p>toRefs ç”¨äºå°†å“åº”å¼å¯¹è±¡è½¬æ¢ä¸ºç»“æœå¯¹è±¡ï¼Œå…¶ä¸­ç»“æœå¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯æŒ‡å‘åŸå§‹å¯¹è±¡ç›¸åº”å±æ€§çš„ refã€‚å¸¸ç”¨äº es6 çš„è§£æ„èµ‹å€¼æ“ä½œï¼Œå› ä¸ºåœ¨å¯¹ä¸€ä¸ªå“åº”å¼å¯¹è±¡ç›´æ¥è§£æ„æ—¶è§£æ„åçš„æ•°æ®å°†ä¸å†æœ‰å“åº”å¼ï¼Œè€Œä½¿ç”¨ toRefs å¯ä»¥æ–¹ä¾¿è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><ul><li>è·å–æ•°æ®å€¼çš„æ—¶å€™éœ€è¦åŠ .value</li><li>toRefs åçš„ ref æ•°æ®ä¸æ˜¯åŸå§‹æ•°æ®çš„æ‹·è´ï¼Œè€Œæ˜¯å¼•ç”¨ï¼Œæ”¹å˜ç»“æœæ•°æ®çš„å€¼ä¹Ÿä¼šåŒæ—¶æ”¹å˜åŸå§‹æ•°æ®</li><li>ä½œç”¨å…¶å®å’Œ toRef ç±»ä¼¼ï¼Œåªä¸è¿‡ toRef æ˜¯ä¸€ä¸ªä¸ªæ‰‹åŠ¨èµ‹å€¼ï¼Œè€Œ toRefs æ˜¯è‡ªåŠ¨èµ‹å€¼ã€‚</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> toRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span>title<span class="token punctuation">]</span><span class="token punctuation">,</span>

  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä½¿ç”¨äº†è§£æ„èµ‹å€¼è¯­æ³•åˆ›å»ºäº†å˜é‡ myTitle</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> myTitle <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myTitle<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ³¨æ„" tabindex="-1"><a class="header-anchor" href="#æ³¨æ„" aria-hidden="true">#</a> æ³¨æ„</h4><p>å°½é‡ä¸è¦æ··ç€ç”¨ï¼Œreactive å’Œ ref é€‰ä¸€ç§ï¼ŒtoRef å’Œ toRefs é€‰ä¸€ç§ï¼Œä¸ç„¶ä»£ç ä¼šå¾ˆä¹±ã€‚</p><h3 id="ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–" tabindex="-1"><a class="header-anchor" href="#ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–" aria-hidden="true">#</a> ç”Ÿå‘½å‘¨æœŸçš„å˜åŒ–</h3><p>æ•´ä½“æ¥çœ‹ï¼Œå˜åŒ–ä¸å¤§ï¼Œåªæ˜¯åå­—å¤§éƒ¨åˆ†éœ€è¦ + <code>on</code>ï¼ŒåŠŸèƒ½ä¸Šç±»ä¼¼ã€‚ä½¿ç”¨ä¸Š Vue3 ç»„åˆå¼ API éœ€è¦å…ˆå¼•å…¥ï¼›Vue2 é€‰é¡¹ API åˆ™å¯ç›´æ¥è°ƒç”¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vue3</span>
<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>     
<span class="token keyword">import</span> <span class="token punctuation">{</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// å¯å°†ä¸åŒçš„é€»è¾‘æ‹†å¼€æˆå¤šä¸ªonMountedï¼Œä¾ç„¶æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸è¢«è¦†ç›–</span>
<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// vue2</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>     
   <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>         
      <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             
        <span class="token operator">...</span>         
      <span class="token punctuation">}</span><span class="token punctuation">,</span>           
   <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¸¸ç”¨ç”Ÿå‘½å‘¨æœŸè¡¨æ ¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p><table><thead><tr><th>Vue2.x</th><th>Vue3</th></tr></thead><tbody><tr><td>beforeCreate</td><td>Not needed*</td></tr><tr><td>created</td><td>Not needed*</td></tr><tr><td>beforeMount</td><td>onBeforeMount</td></tr><tr><td>mounted</td><td>onMounted</td></tr><tr><td>beforeUpdate</td><td>onBeforeUpdate</td></tr><tr><td>updated</td><td>onUpdated</td></tr><tr><td>beforeDestroy</td><td>onBeforeUnmount</td></tr><tr><td>destroyed</td><td>onUnmounted</td></tr></tbody></table><p><strong>Tipsï¼š</strong> <code>setup</code>æ˜¯å›´ç»•<code>beforeCreate</code>å’Œ<code>created</code>ç”Ÿå‘½å‘¨æœŸé’©å­è¿è¡Œçš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æ˜¾å¼åœ°å»å®šä¹‰ã€‚</p><h3 id="å¤šæ ¹èŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#å¤šæ ¹èŠ‚ç‚¹" aria-hidden="true">#</a> å¤šæ ¹èŠ‚ç‚¹</h3><p>Vue3 æ”¯æŒäº†å¤šæ ¹èŠ‚ç‚¹ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯<code>fragment</code>ã€‚</p><p>Vue2 ä¸­ï¼Œç¼–å†™é¡µé¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å»å°†ç»„ä»¶åŒ…è£¹åœ¨<code>&lt;div&gt;</code>ä¸­ï¼Œå¦åˆ™æŠ¥é”™è­¦å‘Šã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>main<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vue3ï¼Œæˆ‘ä»¬å¯ä»¥ç»„ä»¶åŒ…å«å¤šä¸ªæ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥å°‘å†™ä¸€å±‚ï¼Œniceeee ï¼</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>header<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>header<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>main<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>footer<span class="token operator">&gt;</span><span class="token operator">...</span><span class="token operator">&lt;</span><span class="token operator">/</span>footer<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¼‚æ­¥ç»„ä»¶-1" tabindex="-1"><a class="header-anchor" href="#å¼‚æ­¥ç»„ä»¶-1" aria-hidden="true">#</a> å¼‚æ­¥ç»„ä»¶</h3><p>Vue3 æä¾› <code>Suspense</code>ç»„ä»¶ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“å…œåº•çš„å†…å®¹ï¼Œå¦‚ loading ï¼Œä½¿ç”¨æˆ·ä½“éªŒæ›´å¹³æ»‘ã€‚ ä½¿ç”¨å®ƒï¼Œéœ€åœ¨æ¨¡æ¿ä¸­å£°æ˜ï¼Œå¹¶åŒ…æ‹¬ä¸¤ä¸ªå‘½åæ’æ§½ï¼š<code>default</code>å’Œ<code>fallback</code>ã€‚<code>Suspense</code>ç¡®ä¿åŠ è½½å®Œå¼‚æ­¥å†…å®¹æ—¶æ˜¾ç¤ºé»˜è®¤æ’æ§½ï¼Œå¹¶å°†<code>fallback</code>æ’æ§½ç”¨ä½œåŠ è½½çŠ¶æ€ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>tempalte<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>suspense<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template #<span class="token keyword">default</span><span class="token operator">&gt;</span>
 <span class="token operator">&lt;</span>todo<span class="token operator">-</span>list <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>template #fallback<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> Loading<span class="token operator">...</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>suspense<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>çœŸå®çš„é¡¹ç›®ä¸­è¸©è¿‡å‘ï¼Œè‹¥æƒ³åœ¨ setup ä¸­è°ƒç”¨å¼‚æ­¥è¯·æ±‚ï¼Œéœ€åœ¨ setup å‰åŠ <code>async</code>å…³é”®å­—ã€‚è¿™æ—¶ï¼Œä¼šå—åˆ°è­¦å‘Š<code>async setup() is used without a suspense boundary</code>ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šåœ¨çˆ¶é¡µé¢è°ƒç”¨å½“å‰ç»„ä»¶å¤–åŒ…è£¹ä¸€å±‚<code>Suspense</code>ç»„ä»¶ã€‚</p><h3 id="teleport" tabindex="-1"><a class="header-anchor" href="#teleport" aria-hidden="true">#</a> Teleport</h3><p>Vue3 æä¾›<code>Teleport</code>ç»„ä»¶å¯å°†éƒ¨åˆ† DOM ç§»åŠ¨åˆ° Vue app ä¹‹å¤–çš„ä½ç½®ã€‚æ¯”å¦‚é¡¹ç›®ä¸­å¸¸è§çš„<code>Dialog</code>ç»„ä»¶ã€‚</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogVisible = true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>teleport</span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialog<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dialogVisible<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>teleport</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»„åˆå¼-api" tabindex="-1"><a class="header-anchor" href="#ç»„åˆå¼-api" aria-hidden="true">#</a> ç»„åˆå¼ API</h3><p>Vue2 æ˜¯ <code>é€‰é¡¹å¼APIï¼ˆOption APIï¼‰</code>ï¼Œä¸€ä¸ªé€»è¾‘ä¼šæ•£ä¹±åœ¨æ–‡ä»¶ä¸åŒä½ç½®ï¼ˆdataã€propsã€computedã€watchã€ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç­‰ï¼‰ï¼Œå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å˜å·®ï¼Œéœ€è¦ä¸Šä¸‹æ¥å›è·³è½¬æ–‡ä»¶ä½ç½®ã€‚Vue3 <code>ç»„åˆå¼APIï¼ˆComposition APIï¼‰</code>åˆ™å¾ˆå¥½åœ°è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¯å°†åŒä¸€é€»è¾‘çš„å†…å®¹å†™åˆ°ä¸€èµ·ã€‚</p><p>é™¤äº†å¢å¼ºäº†ä»£ç çš„å¯è¯»æ€§ã€å†…èšæ€§ï¼Œç»„åˆå¼ API è¿˜æä¾›äº†è¾ƒä¸ºå®Œç¾çš„é€»è¾‘å¤ç”¨æ€§æ–¹æ¡ˆï¼Œä¸¾ä¸ª ğŸŒ°ï¼Œå¦‚ä¸‹æ‰€ç¤ºå…¬ç”¨é¼ æ ‡åæ ‡æ¡ˆä¾‹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// main.vue</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>mouse position <span class="token punctuation">{</span><span class="token punctuation">{</span> x <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> y <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>
<span class="token keyword">import</span> useMousePosition <span class="token keyword">from</span> <span class="token string">&#39;./useMousePosition&#39;</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span>x<span class="token punctuation">,</span> y<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token comment">// useMousePosition.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token keyword">function</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX
    y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY
  <span class="token punctuation">}</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;mousemove&#39;</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">,</span>
    y
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£å†³äº† Vue2 <code>Mixin</code>çš„å­˜åœ¨çš„å‘½åå†²çªéšæ‚£ï¼Œä¾èµ–å…³ç³»ä¸æ˜ç¡®ï¼Œä¸åŒç»„ä»¶é—´é…ç½®åŒ–ä½¿ç”¨ä¸å¤Ÿçµæ´»ã€‚</p><h3 id="å“åº”å¼åŸç†" tabindex="-1"><a class="header-anchor" href="#å“åº”å¼åŸç†" aria-hidden="true">#</a> å“åº”å¼åŸç†</h3><p>Vue2 å“åº”å¼åŸç†åŸºç¡€æ˜¯<code>Object.defineProperty</code>ï¼›Vue3 å“åº”å¼åŸç†åŸºç¡€æ˜¯ <code>Proxy</code>ã€‚</p><h4 id="object-defineproperty" tabindex="-1"><a class="header-anchor" href="#object-defineproperty" aria-hidden="true">#</a> Object.defineProperty</h4><p>åŸºæœ¬ç”¨æ³•ï¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰æ–°çš„å±æ€§æˆ–ä¿®æ”¹ç°æœ‰çš„å±æ€§ï¼Œå¹¶è¿”å›å¯¹è±¡ã€‚</p><p><strong>Tipsï¼š</strong> <code>writable</code> å’Œ <code>value</code> ä¸ <code>getter</code> å’Œ <code>setter</code> ä¸å…±å­˜ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&#39;ç‘¾è¡Œ&#39;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// å¯æšä¸¾ï¼ˆæ˜¯å¦å¯é€šè¿‡for...in æˆ– Object.keys()è¿›è¡Œè®¿é—®ï¼‰</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// å¯é…ç½®ï¼ˆæ˜¯å¦å¯ä½¿ç”¨deleteåˆ é™¤ï¼Œæ˜¯å¦å¯å†æ¬¡è®¾ç½®å±æ€§ï¼‰</span>
  <span class="token comment">// value: &#39;&#39;, // ä»»æ„ç±»å‹çš„å€¼ï¼Œé»˜è®¤undefined</span>
  <span class="token comment">// writable: true, // å¯é‡å†™</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> name
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¬è¿ Vue2 æ ¸å¿ƒæºç ï¼Œç•¥åˆ å‡ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//  ä¸€  key  ä¸€ä¸ª  dep</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">//  è·å–  key  çš„å±æ€§æè¿°ç¬¦ï¼Œå‘ç°å®ƒæ˜¯ä¸å¯é…ç½®å¯¹è±¡çš„è¯ç›´æ¥  return</span>
  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>configurable <span class="token operator">===</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">}</span>

<span class="token comment">//  è·å–  getter  å’Œ  setterï¼Œå¹¶è·å–  val  å€¼</span>
  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">}</span>

<span class="token comment">//  é€’å½’å¤„ç†ï¼Œä¿è¯å¯¹è±¡ä¸­æ‰€æœ‰  key  è¢«è§‚å¯Ÿ</span>
  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// get  åŠ«æŒ  obj[key]  çš„   è¿›è¡Œä¾èµ–æ”¶é›†</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token keyword">if</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//  ä¾èµ–æ”¶é›†</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>childOb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">//  é’ˆå¯¹åµŒå¥—å¯¹è±¡ï¼Œä¾èµ–æ”¶é›†</span>
          childOb<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token comment">//  è§¦å‘æ•°ç»„å“åº”å¼</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">dependArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// set  æ´¾å‘æ›´æ–°  obj[key]</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span><span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> newVal
    <span class="token punctuation">}</span>
    <span class="token comment">//  æ–°å€¼è®¾ç½®å“åº”å¼</span>
    childOb <span class="token operator">=</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
    <span class="token comment">//  ä¾èµ–é€šçŸ¥æ›´æ–°</span>
    dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‚£ Vue3 ä¸ºä½•ä¼šæŠ›å¼ƒå®ƒå‘¢ï¼Ÿé‚£è‚¯å®šæ˜¯æœ‰ä¸€äº›ç¼ºé™·çš„ã€‚</p><p>ä¸»è¦åŸå› ï¼šæ— æ³•ç›‘å¬å¯¹è±¡æˆ–æ•°ç»„æ–°å¢ã€åˆ é™¤çš„å…ƒç´ ã€‚ Vue2 æ–¹æ¡ˆï¼šé’ˆå¯¹å¸¸ç”¨æ•°ç»„åŸå‹æ–¹æ³•<code>push</code>ã€<code>pop</code>ã€<code>shift</code>ã€<code>unshift</code>ã€<code>splice</code>ã€<code>sort</code>ã€<code>reverse</code>è¿›è¡Œäº† hack å¤„ç†ï¼›æä¾›<code>Vue.set</code>ç›‘å¬å¯¹è±¡/æ•°ç»„æ–°å¢å±æ€§ã€‚å¯¹è±¡çš„æ–°å¢/åˆ é™¤å“åº”ï¼Œè¿˜å¯ä»¥<code>new</code>ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¢åˆ™åˆå¹¶æ–°å±æ€§å’Œæ—§å¯¹è±¡ï¼›åˆ é™¤åˆ™å°†åˆ é™¤å±æ€§åçš„å¯¹è±¡æ·±æ‹·è´ç»™æ–°å¯¹è±¡ã€‚</p><p><strong>Tipsï¼š</strong> <code>Object.defineOProperty</code>æ˜¯å¯ä»¥ç›‘å¬æ•°ç»„å·²æœ‰å…ƒç´ ï¼Œä½† Vue2 æ²¡æœ‰æä¾›çš„åŸå› æ˜¯<code>æ€§èƒ½</code>é—®é¢˜ï¼Œå…·ä½“å¯çœ‹è§<strong>å‚è€ƒ</strong>ç¬¬äºŒç¯‡ ~ã€‚</p><h4 id="proxy" tabindex="-1"><a class="header-anchor" href="#proxy" aria-hidden="true">#</a> Proxy</h4><p><code>Proxy</code>æ˜¯ ES6 æ–°ç‰¹æ€§ï¼Œé€šè¿‡ç¬¬ 2 ä¸ªå‚æ•°<code>handler</code>æ‹¦æˆªç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºã€‚ç›¸è¾ƒäº<code>Object.defineProperty</code>æä¾›è¯­è¨€å…¨èŒƒå›´çš„å“åº”èƒ½åŠ›ï¼Œæ¶ˆé™¤äº†å±€é™æ€§ã€‚ä½†åœ¨å…¼å®¹æ€§ä¸Šæ”¾å¼ƒäº†ï¼ˆIE11 ä»¥ä¸‹ï¼‰</p><p><strong>å±€é™æ€§</strong></p><ol><li>å¯¹è±¡/æ•°ç»„çš„æ–°å¢ã€åˆ é™¤ã€‚</li><li>ç›‘æµ‹.length ä¿®æ”¹ã€‚</li><li>Mapã€Setã€WeakMapã€WeakSet çš„æ”¯æŒã€‚</li></ol><p>åŸºæœ¬ç”¨æ³•ï¼šåˆ›å»ºå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰æ“ä½œã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> prop <span class="token keyword">in</span> obj <span class="token operator">?</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¬è¿ Vue3 çš„æºç  reactive.ts æ–‡ä»¶</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createReactiveObject</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> isReadOnly<span class="token punctuation">,</span> baseHandlers<span class="token punctuation">,</span> collectionHandlers<span class="token punctuation">,</span> proxyMap</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token comment">// collectionHandlers: å¤„ç†Mapã€Setã€WeakMapã€WeakSet // baseHandlers: å¤„ç†æ•°ç»„ã€å¯¹è±¡</span>
   <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span> target<span class="token punctuation">,</span> targetType <span class="token operator">===</span> TargetType<span class="token punctuation">.</span><span class="token constant">COLLECTION</span> <span class="token operator">?</span> collectionHandlers <span class="token operator">:</span> baseHandlers <span class="token punctuation">)</span>
    proxyMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> proxy<span class="token punctuation">)</span> <span class="token keyword">return</span> proxy

  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ baseHandlers.ts ä¸ºä¾‹ï¼Œä½¿ç”¨ Reflect.get è€Œä¸æ˜¯<code>target[key]</code>çš„åŸå› æ˜¯ receiver å‚æ•°å¯ä»¥æŠŠ this æŒ‡å‘ getter è°ƒç”¨æ—¶ï¼Œè€Œé Proxy æ„é€ æ—¶çš„å¯¹è±¡ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//  ä¾èµ–æ”¶é›†</span>
<span class="token keyword">function</span> <span class="token function">createGetter</span><span class="token punctuation">(</span><span class="token parameter">isReadonly <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> shallow <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> Target<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> string <span class="token operator">|</span> symbol<span class="token punctuation">,</span> <span class="token literal-property property">receiver</span><span class="token operator">:</span> object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  æ•°ç»„ç±»å‹</span>
    <span class="token keyword">const</span> targetIsArray <span class="token operator">=</span> <span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isReadonly <span class="token operator">&amp;&amp;</span> targetIsArray <span class="token operator">&amp;&amp;</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>arrayInstrumentations<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arrayInstrumentations<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token comment">//  éæ•°ç»„ç±»å‹</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>

    <span class="token comment">//  å¯¹è±¡é€’å½’è°ƒç”¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> isReadonly <span class="token operator">?</span> <span class="token function">readonly</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">reactive</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//  æ´¾å‘æ›´æ–°</span>
<span class="token keyword">function</span> <span class="token function">createSetter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span>
    <span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> Target<span class="token punctuation">,</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> string <span class="token operator">|</span> symbol<span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> unknown<span class="token punctuation">,</span>
    <span class="token literal-property property">receiver</span><span class="token operator">:</span> Object</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token function">toRaw</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    oldValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">//  å›   ref  æ•°æ®åœ¨  set value  æ—¶å°±å·²  trigger  ä¾èµ–äº†ï¼Œæ‰€ä»¥ç›´æ¥èµ‹å€¼  return  å³å¯</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isRef</span><span class="token punctuation">(</span>oldValue<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isRef</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      oldValue<span class="token punctuation">.</span>value <span class="token operator">=</span> value
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//  å¯¹è±¡æ˜¯å¦æœ‰  key  æœ‰  key setï¼Œæ—   key add</span>
    <span class="token keyword">const</span> hadKey <span class="token operator">=</span> <span class="token function">hasOwn</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token operator">===</span> <span class="token function">toRaw</span><span class="token punctuation">(</span>receiver<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hadKey<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> TriggerOpTypes<span class="token punctuation">.</span><span class="token constant">ADD</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasChanged</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">trigger</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> TriggerOpTypes<span class="token punctuation">.</span><span class="token constant">SET</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> result
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è™šæ‹Ÿ-dom" tabindex="-1"><a class="header-anchor" href="#è™šæ‹Ÿ-dom" aria-hidden="true">#</a> è™šæ‹Ÿ DOM</h3><p>Vue3 ç›¸æ¯”äº Vue2 è™šæ‹Ÿ DOM ä¸Šå¢åŠ <code>patchFlag</code>å­—æ®µã€‚æˆ‘ä»¬å€ŸåŠ©<code>Vue3 Template Explorer</code>æ¥çœ‹ã€‚</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>æŠ€æœ¯æ‘¸é±¼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>ä»Šå¤©å¤©æ°”çœŸä¸é”™<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¸²æŸ“å‡½æ•°å¦‚ä¸‹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createElementVNode <span class="token keyword">as</span> _createElementVNode<span class="token punctuation">,</span> toDisplayString <span class="token keyword">as</span> _toDisplayString<span class="token punctuation">,</span> openBlock <span class="token keyword">as</span> _openBlock<span class="token punctuation">,</span> createElementBlock <span class="token keyword">as</span> _createElementBlock<span class="token punctuation">,</span> pushScopeId <span class="token keyword">as</span> _pushScopeId<span class="token punctuation">,</span> popScopeId <span class="token keyword">as</span> _popScopeId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>

<span class="token keyword">const</span> <span class="token operator">*</span><span class="token function-variable function">withScopeId</span> <span class="token operator">=</span> n <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\\<span class="token function">_pushScopeId</span><span class="token punctuation">(</span><span class="token string">&quot;scope-id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token operator">=</span><span class="token function">n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\\<span class="token function">_popScopeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> _hoisted_2 <span class="token operator">=</span> <span class="token comment">/*#**PURE**_/ _withScopeId(() =&gt; /_#**PURE\\***/</span>\\<span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;æŠ€æœ¯æ‘¸é±¼&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">/</span>_ <span class="token constant">HOISTED</span> _<span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> \\<span class="token operator">*</span>hoisted_3 <span class="token operator">=</span> <span class="token operator">/</span>\\<span class="token operator">*</span>#<span class="token operator">**</span><span class="token constant">PURE</span>\\<span class="token operator">**</span><span class="token operator">*</span><span class="token operator">/</span> <span class="token operator">*</span><span class="token function">withScopeId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token comment">/*#**PURE\\***/</span>\\<span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">/</span>\\<span class="token operator">*</span> <span class="token constant">HOISTED</span> \\_<span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">\\_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>\\<span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> _hoisted_1<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    _hoisted_2<span class="token punctuation">,</span>
    _hoisted_3<span class="token punctuation">,</span>
    <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ç¬¬ 3 ä¸ª<code>_createElementVNode</code>çš„ç¬¬ 4 ä¸ªå‚æ•°å³<code>patchFlag</code>å­—æ®µç±»å‹ï¼Œå­—æ®µç±»å‹æƒ…å†µå¦‚ä¸‹æ‰€ç¤ºã€‚1 ä»£è¡¨èŠ‚ç‚¹ä¸ºåŠ¨æ€æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£åœ¨ diff è¿‡ç¨‹ä¸­ï¼Œåªéœ€æ¯”å¯¹æ–‡æœ¬å¯¹å®¹ï¼Œæ— éœ€å…³æ³¨ classã€style ç­‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå‘ç°æ‰€æœ‰çš„é™æ€èŠ‚ç‚¹ï¼Œéƒ½ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡è¿›è¡Œ<code>é™æ€æå‡</code>ï¼Œå¯åœ¨é‡æ–°æ¸²æŸ“æ—¶ç›´æ¥å¼•ç”¨ï¼Œæ— éœ€é‡æ–°åˆ›å»ºã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> PatchFlags <span class="token punctuation">{</span>
  <span class="token constant">TEXT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€æ–‡æœ¬å†…å®¹</span>
  <span class="token constant">CLASS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€ç±»å</span>
  <span class="token constant">STYLE</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€æ ·å¼</span>
  <span class="token constant">PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€å±æ€§ï¼Œä¸åŒ…å«ç±»åå’Œæ ·å¼</span>
  <span class="token constant">FULL_PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// å…·æœ‰åŠ¨æ€ key å±æ€§ï¼Œå½“ key æ”¹å˜ï¼Œéœ€è¦è¿›è¡Œå®Œæ•´çš„ diff æ¯”è¾ƒ</span>
  <span class="token constant">HYDRATE_EVENTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// å¸¦æœ‰ç›‘å¬äº‹ä»¶çš„èŠ‚ç‚¹</span>
  <span class="token constant">STABLE_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// ä¸ä¼šæ”¹å˜å­èŠ‚ç‚¹é¡ºåºçš„ fragment</span>
  <span class="token constant">KEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// å¸¦æœ‰ key å±æ€§çš„ fragment æˆ–éƒ¨åˆ†å­èŠ‚ç‚¹</span>
  <span class="token constant">UNKEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// å­èŠ‚ç‚¹æ²¡æœ‰ key çš„fragment</span>
  <span class="token constant">NEED_PATCH</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token comment">// åªä¼šè¿›è¡Œé props çš„æ¯”è¾ƒ</span>
  <span class="token constant">DYNAMIC_SLOTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€çš„æ’æ§½</span>
  <span class="token constant">HOISTED</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// é™æ€èŠ‚ç‚¹ï¼Œdiffé˜¶æ®µå¿½ç•¥å…¶å­èŠ‚ç‚¹</span>
  <span class="token constant">BAIL</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token comment">// ä»£è¡¨ diff åº”è¯¥ç»“æŸ</span>
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="äº‹ä»¶ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#äº‹ä»¶ç¼“å­˜" aria-hidden="true">#</a> äº‹ä»¶ç¼“å­˜</h3><p>Vue3 çš„ <code>cacheHandler</code>å¯åœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“åç¼“å­˜æˆ‘ä»¬çš„äº‹ä»¶ã€‚ç›¸æ¯”äº Vue2 æ— éœ€æ¯æ¬¡æ¸²æŸ“éƒ½ä¼ é€’ä¸€ä¸ªæ–°å‡½æ•°ã€‚åŠ ä¸€ä¸ª<code>click</code>äº‹ä»¶ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>æŠ€æœ¯æ‘¸é±¼<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>ä»Šå¤©å¤©æ°”çœŸä¸é”™<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>span onCLick<span class="token operator">=</span><span class="token string">&quot;() =&gt; {}&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>span<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¸²æŸ“å‡½æ•°å¦‚ä¸‹</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createElementVNode <span class="token keyword">as</span> _createElementVNode<span class="token punctuation">,</span> toDisplayString <span class="token keyword">as</span> _toDisplayString<span class="token punctuation">,</span> openBlock <span class="token keyword">as</span> _openBlock<span class="token punctuation">,</span> createElementBlock <span class="token keyword">as</span> _createElementBlock<span class="token punctuation">,</span> pushScopeId <span class="token keyword">as</span> _pushScopeId<span class="token punctuation">,</span> popScopeId <span class="token keyword">as</span> _popScopeId <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span>

<span class="token keyword">const</span> <span class="token operator">*</span><span class="token function-variable function">withScopeId</span> <span class="token operator">=</span> n <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>\\<span class="token function">_pushScopeId</span><span class="token punctuation">(</span><span class="token string">&quot;scope-id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token operator">=</span><span class="token function">n</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>\\<span class="token function">_popScopeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>
<span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> _hoisted_2 <span class="token operator">=</span> <span class="token comment">/*#**PURE**_/ _withScopeId(() =&gt; /_#**PURE\\***/</span>\\<span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;æŠ€æœ¯æ‘¸é±¼&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">/</span>_ <span class="token constant">HOISTED</span> _<span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> \\<span class="token operator">*</span>hoisted<span class="token operator">*</span><span class="token number">3</span> <span class="token operator">=</span> <span class="token operator">/</span>\\<span class="token operator">*</span>#<span class="token operator">**</span><span class="token constant">PURE</span>\\<span class="token operator">**</span><span class="token operator">*</span><span class="token operator">/</span> <span class="token operator">*</span><span class="token function">withScopeId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token comment">/*#**PURE\\***/</span>\\<span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED \\_/))
const \\*hoisted_4 = /\\*#**PURE\\***/</span> <span class="token operator">*</span><span class="token function">withScopeId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token comment">/*#**PURE\\***/</span>\\<span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> onCLick<span class="token operator">:</span> <span class="token string">&quot;() =&gt; {}&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token comment">/*#__PURE__*/</span><span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;span&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">/</span>\\<span class="token operator">*</span> <span class="token constant">HOISTED</span> \\_<span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">\\_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>\\<span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> _hoisted_1<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    _hoisted_2<span class="token punctuation">,</span>
    _hoisted_3<span class="token punctuation">,</span>
    <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    _hoisted_4
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="diff-ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#diff-ä¼˜åŒ–" aria-hidden="true">#</a> Diff ä¼˜åŒ–</h3><p>æ¬è¿ Vue3 patchChildren æºç ã€‚ç»“åˆä¸Šæ–‡ä¸æºç ï¼ŒpatchFlag å¸®åŠ© diff æ—¶åŒºåˆ†é™æ€èŠ‚ç‚¹ï¼Œä»¥åŠä¸åŒç±»å‹çš„åŠ¨æ€èŠ‚ç‚¹ã€‚ä¸€å®šç¨‹åº¦åœ°å‡å°‘èŠ‚ç‚¹æœ¬èº«åŠå…¶å±æ€§çš„æ¯”å¯¹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchChildren</span><span class="token punctuation">(</span><span class="token parameter">n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//  è·å–æ–°è€å­©å­èŠ‚ç‚¹</span>
  <span class="token keyword">const</span> c1 <span class="token operator">=</span> n1 <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>children
  <span class="token keyword">const</span> c2 <span class="token operator">=</span> n2<span class="token punctuation">.</span>children
  <span class="token keyword">const</span> prevShapeFlag <span class="token operator">=</span> n1 <span class="token operator">?</span> n1<span class="token punctuation">.</span>shapeFlag <span class="token operator">:</span> <span class="token number">0</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> patchFlag<span class="token punctuation">,</span> shapeFlag <span class="token punctuation">}</span> <span class="token operator">=</span> n2

<span class="token comment">//  å¤„ç†  patchFlag  å¤§äº  0 </span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>patchFlag <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>patchFlag <span class="token operator">&amp;&amp;</span> PatchFlags<span class="token punctuation">.</span><span class="token constant">KEYED_FRAGMENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  å­˜åœ¨  key</span>
      <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span> els <span class="token keyword">if</span><span class="token punctuation">(</span>patchFlag <span class="token operator">&amp;&amp;</span> PatchFlags<span class="token punctuation">.</span><span class="token constant">UNKEYED_FRAGMENT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  ä¸å­˜åœ¨  key</span>
      <span class="token function">patchUnkeyedChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token comment">//  åŒ¹é…æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼ˆé™æ€ï¼‰ï¼šç§»é™¤è€èŠ‚ç‚¹ï¼Œè®¾ç½®æ–‡æœ¬èŠ‚ç‚¹</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>shapeFlag <span class="token operator">&amp;&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">prevShapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unmountChildren</span><span class="token punctuation">(</span>c1 <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">c2 <span class="token operator">!==</span> c1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">hostSetElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> c2 <span class="token keyword">as</span> string<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//  åŒ¹é…æ–°è€  Vnode  æ˜¯æ•°ç»„ï¼Œåˆ™å…¨é‡æ¯”è¾ƒï¼›å¦åˆ™ç§»é™¤å½“å‰æ‰€æœ‰çš„èŠ‚ç‚¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">prevShapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">shapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">unmountChildren</span><span class="token punctuation">(</span>c1 <span class="token keyword">as</span> VNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>prevShapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">hostSetElementText</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> 
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">shapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">mountChildren</span><span class="token punctuation">(</span>c2 <span class="token keyword">as</span> VNodeArrayChildren<span class="token punctuation">,</span>       container<span class="token punctuation">,</span>anchor<span class="token punctuation">,</span>parentComponent<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>patchUnkeyedChildren æºç å¦‚ä¸‹ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchUnkeyedChildren</span><span class="token punctuation">(</span><span class="token parameter">c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  c1 <span class="token operator">=</span> c1 <span class="token operator">||</span> <span class="token constant">EMPTY_ARR</span>
  c2 <span class="token operator">=</span> c2 <span class="token operator">||</span> <span class="token constant">EMPTY_ARR</span>
  <span class="token keyword">const</span> oldLength <span class="token operator">=</span> c1<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> newLength <span class="token operator">=</span> c2<span class="token punctuation">.</span>length
  <span class="token keyword">const</span> commonLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>oldLength<span class="token punctuation">,</span> newLength<span class="token punctuation">)</span>
  <span class="token keyword">let</span> i
  <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> commonLength<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  å¦‚æœæ–°  Vnode  å·²ç»æŒ‚è½½ï¼Œåˆ™ç›´æ¥  clone  ä¸€ä»½ï¼Œå¦åˆ™æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹</span>
    <span class="token keyword">const</span> nextChild <span class="token operator">=</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> optimized <span class="token operator">?</span> <span class="token function">cloneIfMounted</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">as</span> Vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">normalizeVnode</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>oldLength <span class="token operator">&gt;</span> newLength<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//  ç§»é™¤å¤šä½™çš„èŠ‚ç‚¹</span>
    <span class="token function">unmountedChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//  åˆ›å»ºæ–°çš„èŠ‚ç‚¹</span>
    <span class="token function">mountChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>patchKeyedChildren æºç å¦‚ä¸‹ï¼Œæœ‰è¿ç”¨æœ€é•¿é€’å¢åºåˆ—çš„ç®—æ³•æ€æƒ³ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchKeyedChildren</span><span class="token punctuation">(</span><span class="token parameter">c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSVG<span class="token punctuation">,</span> optimized</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> e1 <span class="token operator">=</span> c1<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">const</span> e2 <span class="token operator">=</span> c2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token keyword">const</span> l2 <span class="token operator">=</span> c2<span class="token punctuation">.</span>length

<span class="token comment">//  ä»å¤´å¼€å§‹éå†ï¼Œè‹¥æ–°è€èŠ‚ç‚¹æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œæ‰§è¡Œ  patch  æ›´æ–°å·®å¼‚ï¼›å¦åˆ™ï¼Œè·³å‡ºå¾ªç¯  </span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> n1 <span class="token operator">=</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">const</span> n2 <span class="token operator">=</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>isSameVnodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSvg<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    i<span class="token operator">++</span>
  <span class="token punctuation">}</span>

<span class="token comment">//  ä»å°¾å¼€å§‹éå†ï¼Œè‹¥æ–°è€èŠ‚ç‚¹æ˜¯åŒä¸€èŠ‚ç‚¹ï¼Œæ‰§è¡Œ  patch  æ›´æ–°å·®å¼‚ï¼›å¦åˆ™ï¼Œè·³å‡ºå¾ªç¯  </span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> n1 <span class="token operator">=</span> c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span>
    <span class="token keyword">const</span> n2 <span class="token operator">=</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isSameVnodeType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSvg<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
    e1<span class="token operator">--</span>
    e2<span class="token operator">--</span>
  <span class="token punctuation">}</span>

<span class="token comment">//  ä»…å­˜åœ¨éœ€è¦æ–°å¢çš„èŠ‚ç‚¹</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
    <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> nextPos <span class="token operator">=</span> e2 <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> l2 <span class="token operator">?</span> c2<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span> <span class="token operator">:</span> parentAnchor
      <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> parentAnchor<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> isSvg<span class="token punctuation">,</span> optimized<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token comment">//  ä»…å­˜åœ¨éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;</span> e2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unmount</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token comment">//  æ–°æ—§èŠ‚ç‚¹å‡æœªéå†å®Œ</span>
  <span class="token comment">// [i ... e1 + 1]: a b [c d e] f g</span>
  <span class="token comment">// [i ... e2 + 1]: a b [e d c h] f g</span>
  <span class="token comment">// i = 2, e1 = 4, e2 = 5</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> s1 <span class="token operator">=</span> i
    <span class="token keyword">const</span> s2 <span class="token operator">=</span> i
    <span class="token comment">//  ç¼“å­˜æ–°  Vnode  å‰©ä½™èŠ‚ç‚¹   ä¸Šä¾‹å³{e: 2, d: 3, c: 4, h: 5}</span>
    <span class="token keyword">const</span> keyToNewIndexMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter">i <span class="token operator">=</span> s2<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">;</span> i<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> nextChild <span class="token operator">=</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> optimized
          <span class="token operator">?</span> <span class="token function">cloneIfMounted</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span>
          <span class="token operator">:</span> <span class="token function">normalizeVNode</span><span class="token punctuation">(</span>c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">nextChild<span class="token punctuation">.</span>key <span class="token operator">!=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">**</span><span class="token constant">DEV</span><span class="token operator">**</span> <span class="token operator">&amp;&amp;</span> keyToNewIndexMap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>nextChild<span class="token punctuation">.</span>key<span class="token punctuation">)</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Duplicate keys found during update:</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span>
             <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>nextChild<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">Make sure keys are unique.</span><span class="token template-punctuation string">\`</span></span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        keyToNewIndexMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>nextChild<span class="token punctuation">.</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">//  è®°å½•å³å°†  patch  çš„   æ–°  Vnode  æ•°é‡</span>
  <span class="token keyword">let</span> patched <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">//  æ–°  Vnode  å‰©ä½™èŠ‚ç‚¹é•¿åº¦</span>
  <span class="token keyword">const</span> toBePatched <span class="token operator">=</span> e2 <span class="token operator">-</span> s2 <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token comment">//  æ˜¯å¦ç§»åŠ¨æ ‡è¯†</span>
  <span class="token keyword">let</span> moved <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">let</span> maxNewindexSoFar <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment">//  åˆå§‹åŒ–   æ–°è€èŠ‚ç‚¹çš„å¯¹åº”å…³ç³»ï¼ˆç”¨äºåç»­æœ€å¤§é€’å¢åºåˆ—ç®—æ³•ï¼‰</span>
  <span class="token keyword">const</span> newIndexToOldIndexMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>toBePatched<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> toBePatched<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> newIndexToOldIndexMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment">//  éå†è€  Vnode  å‰©ä½™èŠ‚ç‚¹</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter">i <span class="token operator">=</span> s1<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> e1<span class="token punctuation">;</span> i<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> prevChild <span class="token operator">=</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

<span class="token comment">//  ä»£è¡¨å½“å‰æ–°  Vnode  éƒ½å·² patchï¼Œå‰©ä½™æ—§  Vnode  ç§»é™¤å³å¯</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">patched <span class="token operator">&gt;=</span> toBePatched</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unmount</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>

<span class="token keyword">let</span> newIndex
    <span class="token comment">//  æ—§  Vnode  å­˜åœ¨  keyï¼Œåˆ™ä»  keyToNewIndexMap  è·å–</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">prevChild<span class="token punctuation">.</span>key <span class="token operator">!=</span> <span class="token keyword">null</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newIndex <span class="token operator">=</span> keyToNewIndexMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
    <span class="token comment">//  æ—§  Vnode  ä¸å­˜åœ¨  keyï¼Œåˆ™éå†æ–°  Vnode  è·å–</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter">j <span class="token operator">=</span> s2<span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> e2<span class="token punctuation">;</span> j<span class="token operator">++</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">newIndexToOldIndexMap<span class="token punctuation">[</span>j <span class="token operator">-</span> s2<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">,</span> c2<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           newIndex <span class="token operator">=</span> j
           <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>           
   <span class="token punctuation">}</span>

<span class="token comment">//  åˆ é™¤ã€æ›´æ–°èŠ‚ç‚¹</span>
   <span class="token comment">//  æ–°  Vnode  æ²¡æœ‰   å½“å‰èŠ‚ç‚¹ï¼Œç§»é™¤</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">newIndex <span class="token operator">===</span> <span class="token keyword">undefined</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">unmount</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">,</span> parentComponent<span class="token punctuation">,</span> parentSuspense<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
     <span class="token comment">//  æ—§  Vnode  çš„ä¸‹æ ‡ä½ç½®  + 1ï¼Œå­˜å‚¨åˆ°å¯¹åº”   æ–°  Vnode  çš„  Map  ä¸­</span>
     <span class="token comment">// + 1  å¤„ç†æ˜¯ä¸ºäº†é˜²æ­¢æ•°ç»„é¦–ä½ä¸‹æ ‡æ˜¯  0  çš„æƒ…å†µï¼Œå› ä¸ºè¿™é‡Œçš„  0  ä»£è¡¨éœ€åˆ›å»ºæ–°èŠ‚ç‚¹</span>
     newIndexToOldIndexMap<span class="token punctuation">[</span>newIndex <span class="token operator">-</span> s2<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

<span class="token comment">//  è‹¥ä¸æ˜¯è¿ç»­é€’å¢ï¼Œåˆ™ä»£è¡¨éœ€è¦ç§»åŠ¨</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">newIndex <span class="token operator">&gt;=</span> maxNewIndexSoFar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       maxNewIndexSoFar <span class="token operator">=</span> newIndex
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       moved <span class="token operator">=</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>

     <span class="token function">patch</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">,</span>c2<span class="token punctuation">[</span>newIndex<span class="token punctuation">]</span><span class="token punctuation">)</span>
     patched<span class="token operator">++</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token comment">//  éå†ç»“æŸï¼ŒnewIndexToOldIndexMap = {0:5, 1:4, 2:3, 3:0}</span>
  <span class="token comment">//  æ–°å»ºã€ç§»åŠ¨èŠ‚ç‚¹</span>
  <span class="token keyword">const</span> increasingNewIndexSequence <span class="token operator">=</span> moved
  <span class="token comment">//  è·å–æœ€é•¿é€’å¢åºåˆ—</span>
  <span class="token operator">?</span> <span class="token function">getSequence</span><span class="token punctuation">(</span>newIndexToOldIndexMap<span class="token punctuation">)</span>
  <span class="token operator">:</span> <span class="token constant">EMPTY_ARR</span>

j <span class="token operator">=</span> increasingNewIndexSequence<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token parameter">i <span class="token operator">=</span> toBePatched <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> nextIndex <span class="token operator">=</span> s2 <span class="token operator">+</span> i
    <span class="token keyword">const</span> nextChild <span class="token operator">=</span> c2<span class="token punctuation">[</span>nextIndex<span class="token punctuation">]</span> <span class="token keyword">as</span> VNode
    <span class="token keyword">const</span> anchor <span class="token operator">=</span> extIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> l2 <span class="token operator">?</span> <span class="token punctuation">(</span>c2<span class="token punctuation">[</span>nextIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">as</span> VNode<span class="token punctuation">)</span><span class="token punctuation">.</span>el <span class="token operator">:</span> parentAnchor
    <span class="token comment">// 0  æ–°å»º  Vnode</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">newIndexToOldIndexMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">0</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>nextChild<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">moved</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//  ç§»åŠ¨èŠ‚ç‚¹</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token parameter">j <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">!==</span> increasingNewIndexSequence<span class="token punctuation">[</span>j<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">move</span><span class="token punctuation">(</span>nextChild<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">,</span> MoveType<span class="token punctuation">.</span><span class="token constant">REORDER</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        j<span class="token operator">--</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰“åŒ…ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#æ‰“åŒ…ä¼˜åŒ–" aria-hidden="true">#</a> æ‰“åŒ…ä¼˜åŒ–</h3><blockquote><p>tree-shakingï¼šæ¨¡å—æ‰“åŒ…<code>webpack</code>ã€<code>rollup</code>ç­‰ä¸­çš„æ¦‚å¿µã€‚ç§»é™¤ JavaScript ä¸Šä¸‹æ–‡ä¸­æœªå¼•ç”¨çš„ä»£ç ã€‚ä¸»è¦ä¾èµ–äº<code>import</code>å’Œ<code>export</code>è¯­å¥ï¼Œç”¨æ¥æ£€æµ‹ä»£ç æ¨¡å—æ˜¯å¦è¢«å¯¼å‡ºã€å¯¼å…¥ï¼Œä¸”è¢« JavaScript æ–‡ä»¶ä½¿ç”¨ã€‚</p></blockquote><p>ä»¥<code>nextTick</code>ä¸ºä¾‹å­ï¼Œåœ¨ Vue2 ä¸­ï¼Œå…¨å±€ API æš´éœ²åœ¨ Vue å®ä¾‹ä¸Šï¼Œå³ä½¿æœªä½¿ç”¨ï¼Œä¹Ÿæ— æ³•é€šè¿‡<code>tree-shaking</code>è¿›è¡Œæ¶ˆé™¤ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//  ä¸€äº›å’Œ DOM æœ‰å…³çš„ä¸œè¥¿</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vue3 ä¸­é’ˆå¯¹å…¨å±€ å’Œå†…éƒ¨çš„ API è¿›è¡Œäº†é‡æ„ï¼Œå¹¶è€ƒè™‘åˆ°<code>tree-shaking</code>çš„æ”¯æŒã€‚å› æ­¤ï¼Œå…¨å±€ API ç°åœ¨åªèƒ½ä½œä¸º ES æ¨¡å—æ„å»ºçš„å‘½åå¯¼å‡ºè¿›è¡Œè®¿é—®ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span>

<span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//  ä¸€äº›å’Œ DOM æœ‰å…³çš„ä¸œè¥¿</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šè¿‡è¿™ä¸€æ›´æ”¹ï¼Œåªè¦æ¨¡å—ç»‘å®šå™¨æ”¯æŒ<code>tree-shaking</code>ï¼Œåˆ™ Vue åº”ç”¨ç¨‹åºä¸­æœªä½¿ç”¨çš„ api å°†ä»æœ€ç»ˆçš„æ†ç»‘åŒ…ä¸­æ¶ˆé™¤ï¼Œè·å¾—æœ€ä½³æ–‡ä»¶å¤§å°ã€‚å—æ­¤æ›´æ”¹å½±å“çš„å…¨å±€ API æœ‰å¦‚ä¸‹ã€‚</p><ul><li>Vue.nextTick</li><li>Vue.observable ï¼ˆç”¨ Vue.reactive æ›¿æ¢ï¼‰</li><li>Vue.version</li><li>Vue.compile ï¼ˆä»…å…¨æ„å»ºï¼‰</li><li>Vue.set ï¼ˆä»…å…¼å®¹æ„å»ºï¼‰</li><li>Vue.delete ï¼ˆä»…å…¼å®¹æ„å»ºï¼‰</li></ul><p>å†…éƒ¨ API ä¹Ÿæœ‰è¯¸å¦‚ transitionã€v-model ç­‰æ ‡ç­¾æˆ–è€…æŒ‡ä»¤è¢«å‘½åå¯¼å‡ºã€‚åªæœ‰åœ¨ç¨‹åºçœŸæ­£ä½¿ç”¨æ‰ä¼šè¢«æ†ç»‘æ‰“åŒ…ã€‚</p><p>æ ¹æ® å°¤å¤§ ç›´æ’­å¯ä»¥çŸ¥é“å¦‚ä»Š Vue3 å°†æ‰€æœ‰è¿è¡ŒåŠŸèƒ½æ‰“åŒ…ä¹Ÿåªæœ‰<code>22.5kb</code>ï¼Œæ¯” Vue2 è½»é‡å¾ˆå¤šã€‚</p><h3 id="è‡ªå®šä¹‰æ¸²æŸ“-api" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰æ¸²æŸ“-api" aria-hidden="true">#</a> è‡ªå®šä¹‰æ¸²æŸ“ API</h3><p>Vue3 æä¾›çš„<code>createApp</code>é»˜è®¤æ˜¯å°† template æ˜ å°„æˆ htmlã€‚ä½†è‹¥æƒ³ç”Ÿæˆ<code>canvas</code>æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨<code>custom renderer api</code>è‡ªå®šä¹‰ render ç”Ÿæˆå‡½æ•°ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//  è‡ªå®šä¹‰ runtime-render å‡½æ•°</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./runtime-render&#39;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./src/App&#39;</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="typescript-æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#typescript-æ”¯æŒ" aria-hidden="true">#</a> TypeScript æ”¯æŒ</h3><p>Vue3 ç”± TS é‡å†™ï¼Œç›¸å¯¹äº Vue2 æœ‰æ›´å¥½åœ°<code>TypeScript</code>æ”¯æŒã€‚</p><ul><li>Vue2 <code>Option API</code>ä¸­ option æ˜¯ä¸ªç®€å•å¯¹è±¡ï¼Œè€Œ TS æ˜¯ä¸€ç§ç±»å‹ç³»ç»Ÿï¼Œé¢å‘å¯¹è±¡çš„è¯­æ³•ï¼Œä¸æ˜¯ç‰¹åˆ«åŒ¹é…ã€‚</li><li>Vue2 éœ€è¦<code>vue-class-component</code>å¼ºåŒ– vue åŸç”Ÿç»„ä»¶ï¼Œä¹Ÿéœ€è¦<code>vue-property-decorator</code>å¢åŠ æ›´å¤šç»“åˆ Vue ç‰¹æ€§çš„è£…é¥°å™¨ï¼Œå†™æ³•æ¯”è¾ƒç¹çã€‚</li></ul><h3 id="å‘¨è¾¹" tabindex="-1"><a class="header-anchor" href="#å‘¨è¾¹" aria-hidden="true">#</a> å‘¨è¾¹</h3><p>åˆ—ä¸¾ä¸€äº› Vue3 é…å¥—äº§ç‰©ï¼Œå…·ä½“ Composition API æ–°è¯­æ³•å¯è§å®˜æ–¹è¿ç§»æ–‡æ¡£ï¼Œå‚è€ƒä¸­æœ‰é“¾æ¥~ ã€‚</p><ul><li><code>vue-cli 4.5.0</code></li><li><code>Vue Router 4.0</code></li><li><code>Vuex 4.0</code></li><li><code>Element plus</code></li><li><code>Vite</code></li></ul><h2 id="å‚è€ƒ" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒ" aria-hidden="true">#</a> å‚è€ƒ</h2><p>Vue3.0 æ€§èƒ½ä¼˜åŒ–ä¹‹é‡å†™è™šæ‹Ÿ Dom[1]<br> è®°ä¸€æ¬¡æ€å¦é—®ç­”çš„é—®é¢˜æ€è€ƒï¼šVue ä¸ºä»€ä¹ˆä¸èƒ½æ£€æµ‹æ•°ç»„å˜åŠ¨[2]<br> Vue3 æºç è§£æç³»åˆ— - å“åº”å¼åŸç†ï¼ˆreactive ç¯‡ï¼‰[3]<br> Vue æºç è§£è¯»ï¼ˆ3ï¼‰â€”â€” å“åº”å¼åŸç†[4]<br> Vue 3 Virtual Dom Diff æºç é˜…è¯»[5]<br> Vue 2 è¿ç§»[6]</p><h3 id="å‚è€ƒèµ„æ–™" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-hidden="true">#</a> å‚è€ƒèµ„æ–™</h3><p>Vue3.0 æ€§èƒ½ä¼˜åŒ–ä¹‹é‡å†™è™šæ‹Ÿ Dom:Â https://blog.csdn.net/summer_zhh/article/details/108080930</p><p>è®°ä¸€æ¬¡æ€å¦é—®ç­”çš„é—®é¢˜æ€è€ƒï¼šVue ä¸ºä»€ä¹ˆä¸èƒ½æ£€æµ‹æ•°ç»„å˜åŠ¨:Â https://segmentfault.com/a/1190000015783546</p><p>Vue3 æºç è§£æç³»åˆ— - å“åº”å¼åŸç†ï¼ˆreactive ç¯‡ï¼‰:Â https://zhuanlan.zhihu.com/p/87899787</p><p>Vue æºç è§£è¯»ï¼ˆ3ï¼‰â€”â€” å“åº”å¼åŸç†: <em>https://juejin.cn/post/6950826293923414047#heading-12</em></p><p>Vue 3 Virtual Dom Diff æºç é˜…è¯»:Â https://segmentfault.com/a/1190000038654183</p><p>Vue 2 è¿ç§»:Â https://v3.vuejs.org/guide/migration/migration-build.html#overview</p><p>æ¨èé˜…è¯» Â Â  ç‚¹å‡»æ ‡é¢˜å¯è·³è½¬</p>`,132),r={href:"http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=2651604918&idx=1&sn=b38b60674bed1074dc3ac90e577176d7&chksm=80229077b7551961ed10a1eea1b0348b375cd21e81e12afa4820a5096f2ca3639ec7d1badb77&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},k={href:"http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=2651603752&idx=2&sn=633bfd9944e6dd6d1c7990ec4a37dafb&chksm=802294e9b7551dff2c697e945f62457f547c8ef25267ecb09d8048853096caf167fb48579df3&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"},d={href:"http://mp.weixin.qq.com/s?__biz=MzAxODE2MjM1MA==&mid=2651603061&idx=1&sn=4a26cb6df32a1abad0789d82a41bcb87&chksm=802297b4b7551ea2d5c6c32305ca242e97b274e20f653726512de129a2dfed2cc50877c3fcb1&scene=21#wechat_redirect",target:"_blank",rel:"noopener noreferrer"};function v(m,b){const a=e("ExternalLinkIcon");return o(),c("div",null,[u,n("p",null,[s("1ã€"),n("a",r,[s("vue é¡¹ç›®ä½ ä¸€å®šä¼šç”¨åˆ°çš„æ€§èƒ½ä¼˜åŒ–ï¼"),t(a)])]),n("p",null,[s("2ã€"),n("a",k,[s("Vue ç»„ä»¶åº“è®¾è®¡ | Vue3 ç»„ä»¶åœ¨çº¿äº¤äº’è§£é‡Šå™¨"),t(a)])]),n("p",null,[s("3ã€"),n("a",d,[s("ä¸€æ–‡ææ‡‚ Vue3.0 ä¸ºä»€ä¹ˆé‡‡ç”¨ Proxy"),t(a)])])])}const y=p(i,[["render",v],["__file","Vue3.0æ–°ç‰¹æ€§.html.vue"]]);export{y as default};
